---
import { formatDuration, stripHtml } from '../utils/podcast';
import type { PodcastEpisode } from '../types/podcast';

interface Props {
  episode: PodcastEpisode;
}

const { episode } = Astro.props;
const { title, description, pubDate, duration, episodeUrl } = episode;

const plainDescription = stripHtml(description);
const truncatedDescription =
  plainDescription.length > 100
    ? plainDescription.slice(0, 100) + '...'
    : plainDescription;
---

<a
  href={episodeUrl}
  target="_blank"
  rel="noopener noreferrer"
  class="block"
>
  <article
    class:list={[
      'p-6 bg-gray-50 dark:bg-gray-800/60 rounded-xl',
      'shadow-md hover:shadow-xl dark:shadow-gray-700/30',
      'dark:hover:shadow-2xl dark:hover:shadow-primary-500/20',
      'border border-gray-700 dark:border-gray-500/50',
      'transition-all duration-200',
    ]}
  >
    <header>
      <h2
        class="text-xl font-bold mb-2 text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400"
      >
        {title}
      </h2>
      <div
        class="flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400 mb-2"
      >
        <time datetime={pubDate.toISOString()}>
          {pubDate.toLocaleDateString('ja-JP')}
        </time>
        {
          duration && (
            <span class="flex items-center gap-1">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                />
              </svg>
              {formatDuration(duration)}
            </span>
          )
        }
      </div>
    </header>
    {
      truncatedDescription && (
        <p class="text-gray-700 dark:text-gray-300 text-sm">
          {truncatedDescription}
        </p>
      )
    }
    <div
      class="mt-3 flex items-center text-primary-600 dark:text-primary-400 text-sm"
    >
      <span>listen.styleで聴く</span>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-4 w-4 ml-1"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
        />
      </svg>
    </div>
  </article>
</a>
